# AppAnalysisSystem

第十三届“中国软件杯”大学生软件设计大赛 A 组赛题 [A2 -涉诈APP智能识别分析系统](https://www.cnsoftbei.com/content-3-980-1.html) —— 落榜作品。

前后端分离架构，前端基于 [vue-element-admin](https://github.com/PanJiaChen/vue-element-admin) 二次开发，后端基于 Django 框架开发（比赛版本使用的是 Flask 框架）。

## 目录📌

- [项目目录](#项目目录)
- [环境要求](#环境要求)
- [配置过程](#配置过程)
- [使用方法](#使用方法)
- [说点什么](#说点什么)
- [License](#License)

## 项目目录

- AppAnalysisSystem：项目后端文件夹
- AppAnalysisSystem-web：项目前端文件夹

## 环境要求

### 推荐版本

- Windows 11

- Python 3.9.7

- pip3

- MySQL 8.4.0

- Node 16.5.1

- JDK 1.8**（必须）**

- SDK

  > [安装教程](https://blog.csdn.net/Yocczy/article/details/130916750)
  >
  > 注：建议多下几个版本的 API 以扩大兼容性，防止使用本系统时出现意外错误。

  SDK 安装后测试：

  ```shell
  # cmd窗口输入
  
  adb
  ```

  若正常回显，则说明安装配置成功。

- 雷电模拟器最新版

### 注意⚠

如果电脑曾经安装了其他版本的 JDK，即使切换到 JDK 1.8，在使用本系统时，仍然会出现由于 JDK 版本不匹配而产生的问题。

具体表现为：测试多个 APK 时，在系统首页中，签名证书那一项的 `MD5` 和 `有效期` 字段总为空。因为非 JDK 1.8 版本，如 JDK 11，使用 JDK 内置 keytool 工具解析的 APK 签名证书，在格式上有所不同。

一种较为有效的解决方法：[方法](https://blog.csdn.net/weixin_43990532/article/details/126351285)。

## 配置过程

### APKtool 环境变量配置

1. 进入后端目录，AppAnalysisSystem/AppAnalysisSystem；

2. 找到 apktool 文件夹，右键，选择”复制文件地址“；

3. 添加环境变量：进入 Windows 系统设置 → 搜索”查看高级系统设置“ → 点击”环境变量“ → 找到系统变量“Path” → 点击“编辑” → 点击“新建” → 输入上一步复制的 apktool 文件地址 → 保存；

4. 验证环境变量是否配置成功：

   ```bash
   # cmd窗口
   
   apktool
   ```

   如果正常回显，说明安装成功。

### 数据库

1. 进入 MySQL 命令行工具；

2. 检查 client 字符集：`show variables like'character_set_%';` ；

   ![](img/mysql.jpg)

3. 如果 `character_set_client ` 不是 `utf8mb4` ，则输入 `set names utf8mb4;` ；

4. 导入后端项目中的 mysql.sql 文件：`source <path-to-mysql.sql>;` 。

5. 更改项目相关配置：进入后端项目文件夹，找到 AppAnalysisSystem/AppAnalysisSystem/settings.py，将数据库用户名和密码替换。

   ```python
   DATABASES = {
       'default': {
           'ENGINE': 'django.db.backends.mysql',
           'NAME': 'app-analysis-system',
           'HOST': '127.0.0.1',
           'PORT': 3306,
           'USER': 'root',
           'PASSWORD': 'root',
       }
   }
   ```

### 雷电模拟器

启动模拟器 → 点击“设置” → 其他设置 → ROOT权限 → 开启 → 重启模拟器。

### 前端

```shell
# 进入前端目录
cd AppAnalysisSystem-web

# 安装依赖
npm install

# 启动前端
npm run dev
```

### 后端

```shell
# 进入后端目录
cd AppAnalysisSystem

# 安装依赖
pip install -r requirements.txt

# 启动后端
python manage.py runserver 0.0.0.0:8000
```

## 使用方法

### 步骤

1. 启动雷电模拟器，完全启动成功后在 cmd 窗口输入 `adb devices` ，确保命令的结果为如下格式：

   ```
   List of devices attached
   emulator-5554   device
   ```

   即存在设备且设备状态不是 `offline` ，否则，多输入几次  `adb devices` 。

   下图为 `offline` 的情况：

   ![](img/mnq1.jpg) 

2. 启动后端。
3. 启动前端。
4. 在浏览器输入 ` http://localhost:8080/` ，即可使用本系统。

### 注意⚠

使用本系统时请不要打开 VPN 工具。

## 说点什么

### 关于作品

回头再看，这个作品从系统设计、文档编写、PPT 制作、视频剪辑等各个方面来看，我觉得还是不咋滴。可能当初为了赶 ddl，而且自己一个人承担那么多任务并且最终还是搞出来了，当时就认为是一个很好的作品。不过无论如何，彼时亦或此时，我始终认为我做的部分（all 分析过程、all 后台开发、all 项目文档编写）都很不错，当然文档写得还是很欠水平，功底不够。

作品当然还有很多改进和完善的地方，当初相当于只是做了一个大体的“壳”出来。当然我现在是不想再优化什么了，最多是把研判模型自己做出来，带着学习的目的。

可优化的点如下：

- **整个前端。**做成数据可视化平台的样子，而不是像现在这样的管理系统。当然如果前端改了后端肯定要跟着改。当然这是有历史原因的，前端负责成员几乎一窍不通，我也没做过前端，何况数据可视化平台，于是当时只能找一个开源前端模板进行二次开发。
- **增加黑白名单配置、展示功能。**如果采集的 APK 不在数据库的名单里面，则可以自动往数据库里增加这个 APK 的条目。然后就是能够在前端增删改查和展示数据库中 APK 名单。
- **图片涉黄检测模型自己写一个。**当初花了很长时间找的一个比较满意的开源模型，结果无法集成到系统中使用，原因无法得知。也尝试过购买商务接口，但单张图片的检测时间太长了，无法接收，所以最好的方法就是自己造轮子。
- **研判模型改进。**系统中使用的研判模型的精确度实在太低了。
- **特征提取和特征工程改进。**关于特征提取，自认为已经做得挺好了。参考了很多文献，基本上能提的都提出来了，印象中只用 API 调用情况和 small 字节码分析没有做，可能还有一些动态特征？特征工程的话，怎么编码、保留哪些特征都是可以改进的，当然要配合研判模型一起做。
- **尝试做文本语义类别划分。**这是当初想要做的点，但似乎技术难度比较大就搁置了。就是将静态存在于 APK 反编译后的文件中的所有字符串，加上从 APK 图片中 OCR 识别出来的字符串，先做一个清洗和预处理，然后做标签划分。因为在人工观察的时候，发现像涉黄、涉诈这些 APP 的文本语义特征是很明显的，懂的都懂。

### 关于Flask和Django

比赛版本的后台是用 Flask 搭建的，现在使用 Django 进行了重置。

个人感觉，Flask 的特点就是轻量，很容易搭建起来一个服务器。但缺点还是轻量，很多东西需要自己集成，自己设计。如果是小型的、功能简单的服务器，比如物联网竞赛的服务器，用 Flask 还是很友好的。如果是像本作品这样的系统，没有严谨的开发规范，就会导致后台设计得很乱，感觉就是一堆零件勉强凑起了一辆能跑的车。虽然现在感觉重置后的后台也很乱，屎山，但更多的是觉得业务代码的屎山，项目结构至少看得下去了。

对于 Django，庞大、笨重，但也因此功能齐全、规范，适合中大型项目和企业级的开发。

## 插曲

由于前端是基于 vue-element-admin 二次开发的，直接 git push 会有  submodule 问题。

首先再次感谢 vue-element-admin 的开源。为解决上述问题，只好将前端项目压缩为 rar 文件上传。但是又出现了一个问题，太大了，超出了 GitHub 的 100MB 限制。使用 git lfs 又屡屡卡在 git push 动不了，没办法只能再将 rar 压缩成 zip，终于降到了 100MB 以下，才能成功不用 lfs 直接 git push。

### 碎碎念

这是我第一次做与科研有点关系的项目，也是第一次带队打比赛做项目。整个团队似乎就我有点经验，当然也就只能是我承担几乎所有的任务。前后 50 多天的高强度工作，前期还是早 9 晚 10，后面就基本上是早 8 晚 10，三餐随便搞点，也熬了几个大夜。

很遗憾最终落榜了，但也不失为一次十分宝贵的经历。没有这次经历，我肯定是走不到现在这个位置的。

中国软件杯失败了，想着打打别的好打一点的比赛，但事情总不是那么如愿的。团队成员的忙，自身时间的尴尬，作品优化的静止……

那就这样吧，能带着我走到这一步，我已经很满足了。遗憾总是存在的，事情总是有得有失。让我达到了现在的高度，但也错失了北邮网安的夏令营，那是我中学和本科很想去的地方，是我离天枢、离网安、离 CTF 最近的一次。同时也失掉了另外一个比赛拿到更高奖项的机会，或许那样我可以走得比现在更远。唉，无论如何，尘埃已定，就让这段时光尘封吧。

至于代码，我已经不想管了，就这样了吧，虽然真的很屎山。物极必反，前面投入的太多了，现在对这个项目、这个课题、这个研究领域已经提不起丝毫兴趣了。

现已将在比赛版本上进行小改进版的源码，以及比赛时提交的文书资料（文档、PPT）开源。欢迎大家学习和参考，提出宝贵的意见或者直接参与贡献。

比赛数据集文件过于庞大，需要可联系作者。

最后，感谢蒋老师、袁同学、谭同学和两个研究生学长，以及曾经努力的自己🎉。

### 鸣谢❤

- [vue-element-admin](https://github.com/PanJiaChen/vue-element-admin)
- [NSFW Model](https://github.com/rockyzhengwu/nsfw)
- [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

## License

[MIT](https://github.com/Nampuchain/AppAnalysisSystem/blob/main/LICENSE)

Copyright©2024 JCYT

